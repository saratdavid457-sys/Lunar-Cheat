-- DXD LEGIT MENU v2 (Solara version)
-- Key System + Aimbot Hitbox + ESP colors + Radar + Fly + Infinite Jump + Invisibility
-- UI stil "legit cheat", compatibil executori gen Solara (foloseste CoreGui/gethui)

----------------------------
-- SERVICES & BASE SETUP  --
----------------------------


local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local LP = Players.LocalPlayer

local function getUiParent()
    local ok, gui = pcall(function() return gethui() end)
    if ok and typeof(gui) == "Instance" then
        return gui
    end
    return game:GetService("CoreGui")
end

local UI_PARENT = getUiParent()

----------------
-- KEY SYSTEM --
----------------
local ACCESS_KEY = "week-12389123wdawdAWdaw11-Lunar"
local ACCESS_KEY = "Day-7081271dawdDAD1238DAW-lunar"
local ACCESS_KEY = "Lifetime-123123adawdawdAwADAWd1231123-lunar"
local unlocked = false

----------------
-- MAIN STATE --
----------------
local scriptActive = true

-- Aimbot / Lock-On
local lockOnEnabled = false
local lockOnHold = false          -- activ doar cand tii click dreapta
local lockOnFOV = 100
local selectedHitbox = "Head"     -- Head / Torso / Arms / Legs

-- ESP
local espEnabled = false
local espHighlights = {}
local espColor = Color3.fromRGB(0,170,255)
local espColorList = {
    Color3.fromRGB(0,170,255),  -- cyan
    Color3.fromRGB(255,80,80),  -- rosu
    Color3.fromRGB(120,255,120),-- verde
    Color3.fromRGB(255,255,80), -- galben
    Color3.fromRGB(180,130,255),-- mov
    Color3.fromRGB(255,160,80), -- portocaliu
    Color3.fromRGB(255,255,255) -- alb
}

-- Radar
local radarEnabled = false
local radarGui, radarFrame, radarDotsFolder

-- Movement / Misc
local flyEnabled = false
local flySpeed = 60
local flyBV, flyBG
local infJumpEnabled = false
local invisEnabled = false

-- UI
local mainGui
local mainFrame
local blurEffect
local pageFrames = {}

----------------
-- UTIL FUNCS --
----------------
local function tween(inst, props, time)
    local TweenService = game:GetService("TweenService")
    local ok, tw = pcall(function()
        return TweenService:Create(inst, TweenInfo.new(time or 0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
    end)
    if ok and tw then pcall(function() tw:Play() end) end
end

local function makeDraggable(frame)
    local dragging = false
    local dragInput, dragStart, startPos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

local function clamp(v, a, b)
    return math.max(a, math.min(b, v))
end

-------------------------
-- BLUR BACKGROUND FX  --
-------------------------
local function enableBlur()
    if blurEffect and blurEffect.Parent then return end
    local ok, err = pcall(function()
        blurEffect = Instance.new("BlurEffect")
        blurEffect.Size = 12
        blurEffect.Parent = Lighting
    end)
    if not ok then
        blurEffect = nil
    end
end

local function disableBlur()
    if blurEffect then
        blurEffect:Destroy()
        blurEffect = nil
    end
end

------------------
-- ESP / HIGHL  --
------------------
local function createESP(plr)
    if not espEnabled then return end
    if plr == LP then return end
    if espHighlights[plr] then return espHighlights[plr] end
    if not plr.Character then return end

    local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local h = Instance.new("Highlight")
    h.Adornee = plr.Character
    h.FillColor = espColor
    h.FillTransparency = 0.6
    h.OutlineColor = Color3.fromRGB(0,0,0)
    h.OutlineTransparency = 0.5
    h.Parent = mainGui or UI_PARENT

    espHighlights[plr] = h
    return h
end

local function updateESP()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LP then
            if espEnabled then
                local h = espHighlights[plr] or createESP(plr)
                if h then
                    h.FillColor = espColor
                    h.Enabled = true
                end
            else
                if espHighlights[plr] then
                    espHighlights[plr].Enabled = false
                end
            end
        end
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        task.wait(1)
        updateESP()
    end)
end)

Players.PlayerRemoving:Connect(function(plr)
    if espHighlights[plr] then
        espHighlights[plr]:Destroy()
        espHighlights[plr] = nil
    end
end)

-----------------
-- RADAR LOGIC --
-----------------
local function createRadarUI()
    if radarGui then radarGui:Destroy() end

    radarGui = Instance.new("ScreenGui")
    radarGui.Name = "Lunar_Radar"
    radarGui.ResetOnSpawn = false
    radarGui.Parent = UI_PARENT

    radarFrame = Instance.new("Frame")
    radarFrame.Size = UDim2.new(0,160,0,160)
    radarFrame.Position = UDim2.new(1,-180,0,80)
    radarFrame.BackgroundColor3 = Color3.fromRGB(10,10,16)
    radarFrame.BorderSizePixel = 0
    radarFrame.Parent = radarGui

    Instance.new("UICorner", radarFrame).CornerRadius = UDim.new(0,14)

    local stroke = Instance.new("UIStroke", radarFrame)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Thickness = 1
    stroke.Color = Color3.fromRGB(0,180,255)

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1,0,0,22)
    title.BackgroundTransparency = 1
    title.Text = "Radar"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextColor3 = Color3.fromRGB(200,200,200)
    title.Parent = radarFrame

    radarDotsFolder = Instance.new("Folder")
    radarDotsFolder.Name = "Dots"
    radarDotsFolder.Parent = radarFrame

    makeDraggable(radarFrame)
end

local function updateRadar()
    if not radarEnabled or not radarFrame or not radarDotsFolder then
        return
    end

    for _,d in ipairs(radarDotsFolder:GetChildren()) do
        d:Destroy()
    end

    local char = LP.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local center = Vector2.new(radarFrame.AbsoluteSize.X/2, radarFrame.AbsoluteSize.Y/2)
    local scale = 0.35

    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LP and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local theirHRP = plr.Character.HumanoidRootPart
            local rel = theirHRP.Position - hrp.Position

            local look = hrp.CFrame.LookVector
            local ang = math.atan2(look.Z, look.X)
            local x = math.cos(ang)*rel.X + math.sin(ang)*rel.Z
            local y = math.cos(ang)*rel.Z - math.sin(ang)*rel.X

            local pos2d = Vector2.new(x,y)*scale
            local screenPos = center + Vector2.new(pos2d.X, -pos2d.Y)

            local dot = Instance.new("Frame")
            dot.Size = UDim2.new(0,6,0,6)
            dot.Position = UDim2.new(0, screenPos.X-3, 0, screenPos.Y-3)
            dot.BackgroundColor3 = Color3.fromRGB(255,0,0)
            dot.BorderSizePixel = 0
            dot.Parent = radarDotsFolder
            Instance.new("UICorner", dot).CornerRadius = UDim.new(1,0)
        end
    end
end

RunService.RenderStepped:Connect(function()
    if scriptActive then
        updateRadar()
    end
end)

--------------
-- FLY LOGIC
--------------
local function disableFly()
    flyEnabled = false
    if flyBV then flyBV:Destroy() flyBV=nil end
    if flyBG then flyBG:Destroy() flyBG=nil end
    local char = LP.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then hum.PlatformStand = false end
    end
end

local function enableFly()
    local char = LP.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    hum.PlatformStand = true

    flyBV = Instance.new("BodyVelocity")
    flyBV.MaxForce = Vector3.new(1e5,1e5,1e5)
    flyBV.Velocity = Vector3.zero
    flyBV.Parent = hrp

    flyBG = Instance.new("BodyGyro")
    flyBG.MaxTorque = Vector3.new(1e5,1e5,1e5)
    flyBG.CFrame = hrp.CFrame
    flyBG.Parent = hrp

    flyEnabled = true
end

RunService.RenderStepped:Connect(function()
    if not scriptActive then return end
    if flyEnabled and flyBV and flyBG then
        local cam = Workspace.CurrentCamera
        if not cam then return end
        local dir = Vector3.new()
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.new(0,1,0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then dir -= Vector3.new(0,1,0) end

        if dir.Magnitude > 0 then
            dir = dir.Unit * flySpeed
        end
        flyBV.Velocity = dir
        flyBG.CFrame = cam.CFrame
    end
end)

-------------------
-- INFINITE JUMP --
-------------------
UserInputService.JumpRequest:Connect(function()
    if infJumpEnabled then
        local char = LP.Character
        if char then
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
                hum.Sit = false
            end
        end
    end
end)

----------------
-- INVISIBILITY
----------------
local function setInvisible(state)
    local char = LP.Character
    if not char then return end
    for _,v in ipairs(char:GetChildren()) do
        if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then
            v.Transparency = state and 1 or 0
            v.CanCollide = not state
        elseif v:IsA("Decal") then
            v.Transparency = state and 1 or 0
        end
    end
end

---------------
-- AIM / FOV --
---------------
local function getHitboxPart(char)
    if not char then return nil end

    if selectedHitbox == "Head" then
        return char:FindFirstChild("Head")
    elseif selectedHitbox == "Torso" then
        return char:FindFirstChild("UpperTorso") or char:FindFirstChild("Torso") or char:FindFirstChild("LowerTorso")
    elseif selectedHitbox == "Arms" then
        return char:FindFirstChild("RightHand")
            or char:FindFirstChild("RightLowerArm")
            or char:FindFirstChild("RightUpperArm")
            or char:FindFirstChild("LeftHand")
            or char:FindFirstChild("LeftLowerArm")
            or char:FindFirstChild("LeftUpperArm")
    elseif selectedHitbox == "Legs" then
        return char:FindFirstChild("RightFoot")
            or char:FindFirstChild("RightLowerLeg")
            or char:FindFirstChild("RightUpperLeg")
            or char:FindFirstChild("LeftFoot")
            or char:FindFirstChild("LeftLowerLeg")
            or char:FindFirstChild("LeftUpperLeg")
    end

    -- fallback
    return char:FindFirstChild("Head") or char:FindFirstChild("HumanoidRootPart")
end

local function getClosestInFOV()
    local cam = Workspace.CurrentCamera
    if not cam then return end
    local mousePos = UserInputService:GetMouseLocation()
    local closest, best = nil, lockOnFOV

    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LP and plr.Character then
            local part = getHitboxPart(plr.Character)
            if part then
                local screenPos, onScreen = cam:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (Vector2.new(screenPos.X,screenPos.Y) - Vector2.new(mousePos.X,mousePos.Y)).Magnitude
                    if dist < best then
                        best = dist
                        closest = part
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if not scriptActive then return end
    if lockOnEnabled and lockOnHold then
        local cam = Workspace.CurrentCamera
        if not cam then return end
        local target = getClosestInFOV()
        if target then
            cam.CFrame = CFrame.new(cam.CFrame.Position, target.Position)
        end
    end
end)

UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        lockOnHold = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        lockOnHold = false
    end
end)

--------------------
-- UI COMPONENTS  --
--------------------
local function createToggle(parent, text, default, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 26)
    btn.BackgroundColor3 = Color3.fromRGB(20,20,26)
    btn.BorderSizePixel = 0
    btn.Text = ""
    btn.AutoButtonColor = false
    btn.Parent = parent

    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)

    local stroke = Instance.new("UIStroke", btn)
    stroke.Color = Color3.fromRGB(60,60,80)
    stroke.Thickness = 1

    local check = Instance.new("Frame")
    check.Size = UDim2.new(0,18,0,18)
    check.Position = UDim2.new(0,6,0.5,-9)
    check.BackgroundColor3 = default and Color3.fromRGB(0,200,120) or Color3.fromRGB(35,35,45)
    check.BorderSizePixel = 0
    check.Parent = btn
    Instance.new("UICorner", check).CornerRadius = UDim.new(0,6)

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1,-30,1,0)
    lbl.Position = UDim2.new(0,28,0,0)
    lbl.BackgroundTransparency = 1
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = Color3.fromRGB(220,220,230)
    lbl.Text = text
    lbl.Parent = btn

    local state = default

    local function setState(v)
        state = v
        tween(check, {
            BackgroundColor3 = state and Color3.fromRGB(0,200,120) or Color3.fromRGB(35,35,45)
        }, 0.15)
        if callback then pcall(callback, state) end
    end

    btn.MouseButton1Click:Connect(function()
        setState(not state)
    end)

    setState(default)
    return setState
end

local function createSlider(parent, title, min, max, default, callback)
    local holder = Instance.new("Frame")
    holder.Size = UDim2.new(1,-20,0,40)
    holder.BackgroundTransparency = 1
    holder.Parent = parent

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1,0,0,18)
    lbl.BackgroundTransparency = 1
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = Color3.fromRGB(220,220,230)
    lbl.Text = title.." : "..tostring(default)
    lbl.Parent = holder

    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(1,0,0,8)
    bar.Position = UDim2.new(0,0,0,24)
    bar.BackgroundColor3 = Color3.fromRGB(25,25,35)
    bar.BorderSizePixel = 0
    bar.Parent = holder
    Instance.new("UICorner", bar).CornerRadius = UDim.new(0,4)

    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    fill.BackgroundColor3 = Color3.fromRGB(0,160,255)
    fill.BorderSizePixel = 0
    fill.Parent = bar
    Instance.new("UICorner", fill).CornerRadius = UDim.new(0,4)

    local dragging = false

    bar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local rel = clamp((input.Position.X - bar.AbsolutePosition.X)/bar.AbsoluteSize.X, 0, 1)
            local val = math.floor(min + rel*(max-min))
            fill.Size = UDim2.new(rel,0,1,0)
            lbl.Text = title.." : "..tostring(val)
            if callback then pcall(callback, val) end
        end
    end)
end

-------------------
-- MAIN DXD MENU --
-------------------
local function buildMainMenu()
    if mainGui then mainGui:Destroy() end

    mainGui = Instance.new("ScreenGui")
    mainGui.Name = "Lunar_LegitMenu"
    mainGui.ResetOnSpawn = false
    mainGui.Parent = UI_PARENT

    enableBlur()

    mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0,720,0,360)
    mainFrame.Position = UDim2.new(0.5,-360,0.5,-180)
    mainFrame.BackgroundColor3 = Color3.fromRGB(8,8,14)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = mainGui
    makeDraggable(mainFrame)

    Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0,12)
    local mainStroke = Instance.new("UIStroke", mainFrame)
    mainStroke.Color = Color3.fromRGB(60,60,90)
    mainStroke.Thickness = 1.2

    local grad = Instance.new("UIGradient", mainFrame)
    grad.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(8,8,14)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(12,12,22))
    }
    grad.Rotation = 90

    -- Sidebar
    local sidebar = Instance.new("Frame")
    sidebar.Size = UDim2.new(0,52,1,0)
    sidebar.Position = UDim2.new(0,0,0,0)
    sidebar.BackgroundColor3 = Color3.fromRGB(6,6,10)
    sidebar.BorderSizePixel = 0
    sidebar.Parent = mainFrame
    Instance.new("UICorner", sidebar).CornerRadius = UDim.new(0,12)
    local sidebarStroke = Instance.new("UIStroke", sidebar)
    sidebarStroke.Color = Color3.fromRGB(40,40,60)
    sidebarStroke.Thickness = 1

    local iconList = Instance.new("UIListLayout", sidebar)
    iconList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    iconList.VerticalAlignment = Enum.VerticalAlignment.Top
    iconList.Padding = UDim.new(0,10)

    local function makeSideButton(symbol)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1,-10,0,40)
        btn.BackgroundColor3 = Color3.fromRGB(10,10,18)
        btn.BorderSizePixel = 0
        btn.Text = symbol
        btn.TextColor3 = Color3.fromRGB(230,230,240)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 22
        btn.Parent = sidebar
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0,10)
        local s = Instance.new("UIStroke", btn)
        s.Color = Color3.fromRGB(40,40,70)
        s.Thickness = 1
        btn.AutoButtonColor = false
        btn.MouseEnter:Connect(function()
            tween(btn, {BackgroundColor3 = Color3.fromRGB(18,18,28)}, 0.15)
        end)
        btn.MouseLeave:Connect(function()
            tween(btn, {BackgroundColor3 = Color3.fromRGB(10,10,18)}, 0.15)
        end)
        return btn
    end

    local btnAimbot = makeSideButton("ðŸŽ¯")
    local btnESP    = makeSideButton("ðŸ‘")
    local btnMisc   = makeSideButton("ðŸŒ")
    local btnSet    = makeSideButton("âš™")

    -- Top bar
    local topBar = Instance.new("Frame")
    topBar.Size = UDim2.new(1,-52,0,32)
    topBar.Position = UDim2.new(0,52,0,0)
    topBar.BackgroundTransparency = 1
    topBar.Parent = mainFrame

    local titleText = Instance.new("TextLabel")
    titleText.Size = UDim2.new(0.5,0,1,0)
    titleText.Position = UDim2.new(0,12,0,0)
    titleText.BackgroundTransparency = 1
    titleText.Font = Enum.Font.GothamBold
    titleText.TextSize = 18
    titleText.TextColor3 = Color3.fromRGB(220,220,235)
    titleText.Text = "Lunar | Aimbot"
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Parent = topBar

    -- Content area
    local content = Instance.new("Frame")
    content.Size = UDim2.new(1,-60,1,-40)
    content.Position = UDim2.new(0,56,0,36)
    content.BackgroundTransparency = 1
    content.Parent = mainFrame

    local leftPanel = Instance.new("Frame")
    leftPanel.Size = UDim2.new(0.5,-8,1,0)
    leftPanel.Position = UDim2.new(0,0,0,0)
    leftPanel.BackgroundColor3 = Color3.fromRGB(12,12,20)
    leftPanel.BorderSizePixel = 0
    leftPanel.Parent = content
    Instance.new("UICorner", leftPanel).CornerRadius = UDim.new(0,10)
    local ls = Instance.new("UIStroke", leftPanel)
    ls.Color = Color3.fromRGB(35,35,60)
    ls.Thickness = 1

    local rightPanel = Instance.new("Frame")
    rightPanel.Size = UDim2.new(0.5,-8,1,0)
    rightPanel.Position = UDim2.new(0.5,8,0,0)
    rightPanel.BackgroundColor3 = Color3.fromRGB(12,12,20)
    rightPanel.BorderSizePixel = 0
    rightPanel.Parent = content
    Instance.new("UICorner", rightPanel).CornerRadius = UDim.new(0,10)
    local rs = Instance.new("UIStroke", rightPanel)
    rs.Color = Color3.fromRGB(35,35,60)
    rs.Thickness = 1

    ----------------
    -- AIMBOT PAGE
    ----------------
    local aimbotLeft = Instance.new("Frame", leftPanel)
    aimbotLeft.Size = UDim2.new(1,0,1,0)
    aimbotLeft.BackgroundTransparency = 1

    local aimbotRight = Instance.new("Frame", rightPanel)
    aimbotRight.Size = UDim2.new(1,0,1,0)
    aimbotRight.BackgroundTransparency = 1

    pageFrames["Aimbot"] = {Left=aimbotLeft, Right=aimbotRight}

    local alTitle = Instance.new("TextLabel", aimbotLeft)
    alTitle.Size = UDim2.new(1,-20,0,24)
    alTitle.Position = UDim2.new(0,10,0,8)
    alTitle.BackgroundTransparency = 1
    alTitle.Font = Enum.Font.GothamBold
    alTitle.TextSize = 16
    alTitle.TextColor3 = Color3.fromRGB(220,220,230)
    alTitle.TextXAlignment = Enum.TextXAlignment.Left
    alTitle.Text = "Aimbot / Lock-On"

    local alContainer = Instance.new("Frame", aimbotLeft)
    alContainer.Size = UDim2.new(1,-20,1,-40)
    alContainer.Position = UDim2.new(0,10,0,32)
    alContainer.BackgroundTransparency = 1
    local alLayout = Instance.new("UIListLayout", alContainer)
    alLayout.SortOrder = Enum.SortOrder.LayoutOrder
    alLayout.Padding = UDim.new(0,6)

    createToggle(alContainer, "Enable Lock-On (hold RMB)", false, function(state)
        lockOnEnabled = state
    end)

    createSlider(alContainer, "FOV Size", 40, 400, lockOnFOV, function(v)
        lockOnFOV = v
    end)

    local arTitle = Instance.new("TextLabel", aimbotRight)
    arTitle.Size = UDim2.new(1,-20,0,24)
    arTitle.Position = UDim2.new(0,10,0,8)
    arTitle.BackgroundTransparency = 1
    arTitle.Font = Enum.Font.GothamBold
    arTitle.TextSize = 16
    arTitle.TextColor3 = Color3.fromRGB(220,220,230)
    arTitle.TextXAlignment = Enum.TextXAlignment.Left
    arTitle.Text = "Aimbot Settings"

    local arContainer = Instance.new("Frame", aimbotRight)
    arContainer.Size = UDim2.new(1,-20,1,-40)
    arContainer.Position = UDim2.new(0,10,0,32)
    arContainer.BackgroundTransparency = 1

    local targetLabel = Instance.new("TextLabel", arContainer)
    targetLabel.Size = UDim2.new(1,0,0,24)
    targetLabel.BackgroundColor3 = Color3.fromRGB(18,18,26)
    targetLabel.BorderSizePixel = 0
    targetLabel.Font = Enum.Font.Gotham
    targetLabel.TextSize = 14
    targetLabel.TextColor3 = Color3.fromRGB(200,200,210)
    targetLabel.Text = "Target Hitbox: Head"
    targetLabel.TextXAlignment = Enum.TextXAlignment.Left
    Instance.new("UICorner", targetLabel).CornerRadius = UDim.new(0,6)
    local tlS = Instance.new("UIStroke", targetLabel)
    tlS.Color = Color3.fromRGB(40,40,70)

    local hitboxRow = Instance.new("Frame", arContainer)
    hitboxRow.Size = UDim2.new(1,0,0,30)
    hitboxRow.Position = UDim2.new(0,0,0,32)
    hitboxRow.BackgroundTransparency = 1
    local hbList = Instance.new("UIListLayout", hitboxRow)
    hbList.FillDirection = Enum.FillDirection.Horizontal
    hbList.Padding = UDim.new(0,6)

    local function makeHitboxButton(name, labelText)
        local b = Instance.new("TextButton")
        b.Size = UDim2.new(0,70,1,0)
        b.BackgroundColor3 = Color3.fromRGB(18,18,26)
        b.BorderSizePixel = 0
        b.Font = Enum.Font.Gotham
        b.TextSize = 12
        b.TextColor3 = Color3.fromRGB(200,200,210)
        b.Text = labelText
        b.Parent = hitboxRow
        Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
        local s = Instance.new("UIStroke", b)
        s.Color = Color3.fromRGB(40,40,70)
        s.Thickness = 1

        b.MouseButton1Click:Connect(function()
            selectedHitbox = name
            targetLabel.Text = "Target Hitbox: "..labelText
        end)
    end

    makeHitboxButton("Head","Head")
    makeHitboxButton("Torso","Torso")
    makeHitboxButton("Arms","Arms")
    makeHitboxButton("Legs","Legs")

    -------------------------
    -- VISUALS PAGE (ESP)  --
    -------------------------
    local visualsLeft = Instance.new("Frame", leftPanel)
    visualsLeft.Size = UDim2.new(1,0,1,0)
    visualsLeft.BackgroundTransparency = 1

    local visualsRight = Instance.new("Frame", rightPanel)
    visualsRight.Size = UDim2.new(1,0,1,0)
    visualsRight.BackgroundTransparency = 1

    pageFrames["Visuals"] = {Left=visualsLeft, Right=visualsRight}
    visualsLeft.Visible = false
    visualsRight.Visible = false

    local vlTitle = Instance.new("TextLabel", visualsLeft)
    vlTitle.Size = UDim2.new(1,-20,0,24)
    vlTitle.Position = UDim2.new(0,10,0,8)
    vlTitle.BackgroundTransparency = 1
    vlTitle.Font = Enum.Font.GothamBold
    vlTitle.TextSize = 16
    vlTitle.TextColor3 = Color3.fromRGB(220,220,230)
    vlTitle.TextXAlignment = Enum.TextXAlignment.Left
    vlTitle.Text = "ESP"

    local vlContainer = Instance.new("Frame", visualsLeft)
    vlContainer.Size = UDim2.new(1,-20,1,-40)
    vlContainer.Position = UDim2.new(0,10,0,32)
    vlContainer.BackgroundTransparency = 1
    local vlLayout = Instance.new("UIListLayout", vlContainer)
    vlLayout.SortOrder = Enum.SortOrder.LayoutOrder
    vlLayout.Padding = UDim.new(0,6)

    createToggle(vlContainer, "Enable ESP", false, function(state)
        espEnabled = state
        updateESP()
    end)

    local colorRow = Instance.new("Frame", vlContainer)
    colorRow.Size = UDim2.new(1,-20,0,26)
    colorRow.BackgroundTransparency = 1
    local colorLayout = Instance.new("UIListLayout", colorRow)
    colorLayout.FillDirection = Enum.FillDirection.Horizontal
    colorLayout.Padding = UDim.new(0,6)

    for _,c in ipairs(espColorList) do
        local b = Instance.new("TextButton")
        b.Size = UDim2.new(0,24,1,0)
        b.Text = ""
        b.BackgroundColor3 = c
        b.BorderSizePixel = 0
        b.Parent = colorRow
        Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
        b.MouseButton1Click:Connect(function()
            espColor = c
            updateESP()
        end)
    end

    local vrTitle = Instance.new("TextLabel", visualsRight)
    vrTitle.Size = UDim2.new(1,-20,0,24)
    vrTitle.Position = UDim2.new(0,10,0,8)
    vrTitle.BackgroundTransparency = 1
    vrTitle.Font = Enum.Font.GothamBold
    vrTitle.TextSize = 16
    vrTitle.TextColor3 = Color3.fromRGB(220,220,230)
    vrTitle.TextXAlignment = Enum.TextXAlignment.Left
    vrTitle.Text = "Radar"

    local vrContainer = Instance.new("Frame", visualsRight)
    vrContainer.Size = UDim2.new(1,-20,1,-40)
    vrContainer.Position = UDim2.new(0,10,0,32)
    vrContainer.BackgroundTransparency = 1

    createToggle(vrContainer, "Enable Radar", false, function(state)
        radarEnabled = state
        if state then
            createRadarUI()
        elseif radarGui then
            radarGui:Destroy()
            radarGui = nil
            radarFrame = nil
            radarDotsFolder = nil
        end
    end)

    ------------------------------
    -- MOVEMENT / MISC PAGE     --
    ------------------------------
    local miscLeft = Instance.new("Frame", leftPanel)
    miscLeft.Size = UDim2.new(1,0,1,0)
    miscLeft.BackgroundTransparency = 1

    local miscRight = Instance.new("Frame", rightPanel)
    miscRight.Size = UDim2.new(1,0,1,0)
    miscRight.BackgroundTransparency = 1

    pageFrames["Movement"] = {Left=miscLeft, Right=miscRight}
    miscLeft.Visible = false
    miscRight.Visible = false

    local mlTitle = Instance.new("TextLabel", miscLeft)
    mlTitle.Size = UDim2.new(1,-20,0,24)
    mlTitle.Position = UDim2.new(0,10,0,8)
    mlTitle.BackgroundTransparency = 1
    mlTitle.Font = Enum.Font.GothamBold
    mlTitle.TextSize = 16
    mlTitle.TextColor3 = Color3.fromRGB(220,220,230)
    mlTitle.TextXAlignment = Enum.TextXAlignment.Left
    mlTitle.Text = "Movement"

    local mlContainer = Instance.new("Frame", miscLeft)
    mlContainer.Size = UDim2.new(1,-20,1,-40)
    mlContainer.Position = UDim2.new(0,10,0,32)
    mlContainer.BackgroundTransparency = 1
    local mlLayout = Instance.new("UIListLayout", mlContainer)
    mlLayout.Padding = UDim.new(0,6)

    createToggle(mlContainer, "Fly (E quick toggle)", false, function(state)
        if state then
            enableFly()
        else
            disableFly()
        end
    end)

    createSlider(mlContainer, "Fly Speed", 20, 200, flySpeed, function(v)
        flySpeed = v
    end)

    createToggle(mlContainer, "Infinite Jump", false, function(state)
        infJumpEnabled = state
    end)

    local mrTitle = Instance.new("TextLabel", miscRight)
    mrTitle.Size = UDim2.new(1,-20,0,24)
    mrTitle.Position = UDim2.new(0,10,0,8)
    mrTitle.BackgroundTransparency = 1
    mrTitle.Font = Enum.Font.GothamBold
    mrTitle.TextSize = 16
    mrTitle.TextColor3 = Color3.fromRGB(220,220,230)
    mrTitle.TextXAlignment = Enum.TextXAlignment.Left
    mrTitle.Text = "Visibility"

    local mrContainer = Instance.new("Frame", miscRight)
    mrContainer.Size = UDim2.new(1,-20,1,-40)
    mrContainer.Position = UDim2.new(0,10,0,32)
    mrContainer.BackgroundTransparency = 1

    createToggle(mrContainer, "Invisible Character", false, function(state)
        invisEnabled = state
        setInvisible(state)
    end)

    --------------------
    -- SETTINGS PAGE  --
    --------------------
    local setLeft = Instance.new("Frame", leftPanel)
    setLeft.Size = UDim2.new(1,0,1,0)
    setLeft.BackgroundTransparency = 1

    local setRight = Instance.new("Frame", rightPanel)
    setRight.Size = UDim2.new(1,0,1,0)
    setRight.BackgroundTransparency = 1

    pageFrames["Settings"] = {Left=setLeft, Right=setRight}
    setLeft.Visible = false
    setRight.Visible = false

    local slTitle = Instance.new("TextLabel", setLeft)
    slTitle.Size = UDim2.new(1,-20,0,24)
    slTitle.Position = UDim2.new(0,10,0,8)
    slTitle.BackgroundTransparency = 1
    slTitle.Font = Enum.Font.GothamBold
    slTitle.TextSize = 16
    slTitle.TextColor3 = Color3.fromRGB(220,220,230)
    slTitle.TextXAlignment = Enum.TextXAlignment.Left
    slTitle.Text = "Script"

    local slContainer = Instance.new("Frame", setLeft)
    slContainer.Size = UDim2.new(1,-20,1,-40)
    slContainer.Position = UDim2.new(0,10,0,32)
    slContainer.BackgroundTransparency = 1

    local unloadBtn = Instance.new("TextButton", slContainer)
    unloadBtn.Size = UDim2.new(1,-20,0,30)
    unloadBtn.Position = UDim2.new(0,0,0,0)
    unloadBtn.BackgroundColor3 = Color3.fromRGB(180,40,40)
    unloadBtn.Text = "Unload Lunar Menu"
    unloadBtn.Font = Enum.Font.GothamBold
    unloadBtn.TextSize = 14
    unloadBtn.TextColor3 = Color3.fromRGB(240,240,240)
    unloadBtn.BorderSizePixel = 0
    Instance.new("UICorner", unloadBtn).CornerRadius = UDim.new(0,8)

    unloadBtn.MouseButton1Click:Connect(function()
        scriptActive = false
        disableFly()
        setInvisible(false)
        infJumpEnabled = false
        espEnabled = false
        radarEnabled = false
        updateESP()
        if radarGui then radarGui:Destroy() end
        if mainGui then mainGui:Destroy() end
        disableBlur()
    end)

    local srTitle = Instance.new("TextLabel", setRight)
    srTitle.Size = UDim2.new(1,-20,0,24)
    srTitle.Position = UDim2.new(0,10,0,8)
    srTitle.BackgroundTransparency = 1
    srTitle.Font = Enum.Font.GothamBold
    srTitle.TextSize = 16
    srTitle.TextColor3 = Color3.fromRGB(220,220,230)
    srTitle.TextXAlignment = Enum.TextXAlignment.Left
    srTitle.Text = "Info"

    local srContainer = Instance.new("Frame", setRight)
    srContainer.Size = UDim2.new(1,-20,1,-40)
    srContainer.Position = UDim2.new(0,10,0,32)
    srContainer.BackgroundTransparency = 1

    local infoLabel = Instance.new("TextLabel", srContainer)
    infoLabel.Size = UDim2.new(1,-0,0,60)
    infoLabel.Position = UDim2.new(0,0,0,0)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextSize = 14
    infoLabel.TextColor3 = Color3.fromRGB(210,210,220)
    infoLabel.TextWrapped = true
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.Text = "\nToggle menu: Insert\nQuick Fly toggle: E\Enjoi The cheat"

    -- Sidebar switching
    local function showPage(name, title)
        for _,p in pairs(pageFrames) do
            p.Left.Visible = false
            p.Right.Visible = false
        end
        if pageFrames[name] then
            pageFrames[name].Left.Visible = true
            pageFrames[name].Right.Visible = true
        end
        titleText.Text = "Lunar | "..title
    end

    btnAimbot.MouseButton1Click:Connect(function() showPage("Aimbot","Aimbot") end)
    btnESP.MouseButton1Click:Connect(function() showPage("Visuals","Visuals") end)
    btnMisc.MouseButton1Click:Connect(function() showPage("Movement","Movement") end)
    btnSet.MouseButton1Click:Connect(function() showPage("Settings","Settings") end)

    showPage("Aimbot","Aimbot")
end

--------------------------
-- KEY / PASSWORD SCREEN
--------------------------
local function openKeyUI()
    local gui = Instance.new("ScreenGui")
    gui.Name = "Lunar_KeyUI"
    gui.ResetOnSpawn = false
    gui.Parent = UI_PARENT

    enableBlur()

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0,360,0,160)
    frame.Position = UDim2.new(0.5,-180,0.5,-80)
    frame.BackgroundColor3 = Color3.fromRGB(10,10,18)
    frame.BorderSizePixel = 0
    frame.Parent = gui
    makeDraggable(frame)

    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)
    local st = Instance.new("UIStroke", frame)
    st.Color = Color3.fromRGB(60,60,90)
    st.Thickness = 1.2

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1,-20,0,30)
    title.Position = UDim2.new(0,10,0,10)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextColor3 = Color3.fromRGB(220,220,240)
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Text = "Lunar | Enter Access Key"

    local box = Instance.new("TextBox", frame)
    box.Size = UDim2.new(1,-20,0,32)
    box.Position = UDim2.new(0,10,0,52)
    box.BackgroundColor3 = Color3.fromRGB(18,18,26)
    box.BorderSizePixel = 0
    box.Font = Enum.Font.Gotham
    box.TextSize = 16
    box.TextColor3 = Color3.fromRGB(230,230,240)
    box.PlaceholderText = "Key"
    box.Text = ""
    Instance.new("UICorner", box).CornerRadius = UDim.new(0,8)

    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(1,-20,0,32)
    btn.Position = UDim2.new(0,10,0,96)
    btn.BackgroundColor3 = Color3.fromRGB(0,170,255)
    btn.BorderSizePixel = 0
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(240,240,255)
    btn.Text = "Unlock"
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)

    local info = Instance.new("TextLabel", frame)
    info.Size = UDim2.new(1,-20,0,20)
    info.Position = UDim2.new(0,10,1,-24)
    info.BackgroundTransparency = 1
    info.Font = Enum.Font.Gotham
    info.TextSize = 13
    info.TextColor3 = Color3.fromRGB(200,80,80)
    info.TextXAlignment = Enum.TextXAlignment.Left
    info.Text = ""

    btn.MouseButton1Click:Connect(function()
        if box.Text == ACCESS_KEY then
            unlocked = true
            gui:Destroy()
            buildMainMenu()
        else
            box.Text = ""
            box.PlaceholderText = "Invalid key!"
            info.Text = "Wrong key. Try again."
        end
    end)
end

--------------------
-- MENU TOGGLE KEY
--------------------
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.Insert then
        if unlocked and mainGui then
            mainGui.Enabled = not mainGui.Enabled
            if mainGui.Enabled then
                enableBlur()
            else
                disableBlur()
            end
        end
    elseif input.KeyCode == Enum.KeyCode.E then
        if unlocked then
            if flyEnabled then
                disableFly()
            else
                enableFly()
            end
        end
    end
end)

----------------
-- START
----------------
openKeyUI()
